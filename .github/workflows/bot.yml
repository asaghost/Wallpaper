name: Daily Wallpaper Bot
on:
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch:

jobs:
  post:
    runs-on: ubuntu-latest
    steps:
      - name: Generate and Post
        run: |
          # 1. ุทูุจ ุชูููุฏ ุงูุตูุฑุฉ
          curl -s -X POST "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image:generateContent?key=AIzaSyBaUh3GG_JXDQyRW8MQo3goMbpZyjWb9SY" \
          -H "Content-Type: application/json" \
          -d '{"contents": [{"parts": [{"text": "Professional 8k wallpaper, Galaxy and Planets, cinematic lighting, masterpiece"}]}], "generation_config": {"image_config": {"aspect_ratio": "9:16"}}}' > res.json
          
          # 2. ุงุณุชุฎุฑุงุฌ ุจูุงูุงุช ุงูุตูุฑุฉ (ุทุฑููุฉ ุฐููุฉ ุชุจุญุซ ูู ูู ุงูุฃุฌุฒุงุก)
          IMG_DATA=$(cat res.json | jq -r '.candidates[0].content.parts[] | select(.inlineData != null) | .inlineData.data')
          
          if [ -z "$IMG_DATA" ] || [ "$IMG_DATA" == "null" ]; then
            echo "โ ุฎุทุฃ: ูู ูุชู ุงูุนุซูุฑ ุนูู ุจูุงูุงุช ุงูุตูุฑุฉ ูู ุฑุฏ ุงูู API"
            cat res.json
            exit 1
          fi
          
          # 3. ุชุญููู ุงูุจูุงูุงุช ูุตูุฑุฉ
          echo $IMG_DATA | base64 -d > wallpaper.png
          
          # 4. ุงูุฅุฑุณุงู ูุชูุบุฑุงู
          curl -s -X POST "https://api.telegram.org/bot8475807409:AAHNj5nCT4BnwOrMSHoviStSUDgRwn_QO4g/sendPhoto" \
          -F "chat_id=@MobWallpaper4k" \
          -F "photo=@wallpaper.png" \
          -F "caption=๐จ ุฎูููุฉ ุฌุฏูุฏุฉ ุชู ุชูููุฏูุง ุขููุงู\n๐ ุงูููุถูุน: Galaxy and Planets"
