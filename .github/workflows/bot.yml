name: Daily Wallpaper Bot
on:
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch:

jobs:
  post:
    runs-on: ubuntu-latest
    steps:
      - name: Generate and Post
        run: |
          echo "๐ ุจุฏุก ุนูููุฉ ุชูููุฏ ุงูุตูุฑุฉ..."
          
          # 1. ุฅุฑุณุงู ุงูุทูุจ ูุญูุธ ุงูุฑุฏ ูุน ููุฏ ุงูุญุงูุฉ
          RESPONSE=$(curl -s -w "
%{http_code}" -X POST "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image:generateContent?key=AIzaSyBaUh3GG_JXDQyRW8MQo3goMbpZyjWb9SY" \
          -H "Content-Type: application/json" \
          -d '{"contents": [{"parts": [{"text": "Professional 8k mobile wallpaper, Galaxy and Planets, cinematic lighting, masterpiece, high resolution"}]}], "generation_config": {"image_config": {"aspect_ratio": "9:16"}}}')
          
          HTTP_STATUS=$(echo "$RESPONSE" | tail -n 1)
          BODY=$(echo "$RESPONSE" | sed '$d')
          
          echo "Status Code: $HTTP_STATUS"
          
          if [ "$HTTP_STATUS" -ne 200 ]; then
            echo "โ ุฎุทุฃ ูู ุฌูุฌู API:"
            echo "$BODY" | jq '.'
            exit 1
          fi

          # 2. ุงุณุชุฎุฑุงุฌ ุจูุงูุงุช ุงูุตูุฑุฉ
          IMG_DATA=$(echo "$BODY" | jq -r '.candidates[0].content.parts[] | select(.inlineData != null) | .inlineData.data // empty')
          
          if [ -z "$IMG_DATA" ]; then
            echo "โ ูุดู: ุงูุฑุฏ ุณููู ูููู ูุง ูุญุชูู ุนูู ุตูุฑุฉ. ุงูุฑุฏ ุงููุงูู:"
            echo "$BODY" | jq '.'
            exit 1
          fi
          
          # 3. ุชุญููู ูุชุฎุฒูู ุงูุตูุฑุฉ
          echo "$IMG_DATA" | base64 -d > wallpaper.png
          echo "โ ุชู ุชูููุฏ ุงูุตูุฑุฉ ุจูุฌุงุญ."
          
          # 4. ุงูุฅุฑุณุงู ูุชูุบุฑุงู
          SEND_RES=$(curl -s -X POST "https://api.telegram.org/bot8475807409:AAHNj5nCT4BnwOrMSHoviStSUDgRwn_QO4g/sendPhoto" \
          -F "chat_id=@MobWallpaper4k" \
          -F "photo=@wallpaper.png" \
          -F "caption=๐จ ุฎูููุฉ ุฌุฏูุฏุฉ ุชู ุชูููุฏูุง\n๐ ุงูููุถูุน: Galaxy and Planets")
          
          if echo "$SEND_RES" | grep -q '"ok":true'; then
            echo "โ ุชู ุงูุฅุฑุณุงู ูุชูุบุฑุงู ุจูุฌุงุญ."
          else
            echo "โ ูุดู ุงูุฅุฑุณุงู ูุชูุบุฑุงู:"
            echo "$SEND_RES" | jq '.'
            exit 1
          fi
